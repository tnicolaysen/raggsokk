<html>
<head>
	<title>Autocomplete with Bacon.js</title>

	<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.3.0/pure-min.css">

	<script type="text/javascript" src="../bower_components/jquery/jquery.js"></script>
	<script type="text/javascript" src="../bower_components/bacon/dist/Bacon.js"></script>
	
	<script type="text/javascript">
		$(function() {
			var ws = new WebSocket("ws://localhost:8080");
  
            var search = ws.send.bind(ws);

            var notEmpty = function(i) {
                return i !== "";
            };

			$("#query")
				.asEventStream("keyup")
				.debounce(300)
				.map(function(e) {
                    return e.currentTarget.value;
				})
				.filter(notEmpty)
				.doAction(ws, 'send')
                .onValue(function(input) {
                    console.log('Searching', input);
                });


			var server = Bacon.fromEventTarget(ws, 'message');
            server.map(function(e) {
                    return JSON.parse(e.data);
                })
                .onValue(function(cities) {
                    console.log("Results:", cities.length, cities);
                })
            server.onValue(function(city) {
            	console.log(city);
            });
		});
	</script>
</head>
<body>
	<div class="pure-g">
	    <div class="pure-u-1-3">
	        <!-- Padding -->
	    </div>

	    <div class="pure-u-1-3">
			<form class="pure-form pure-form-stacked">
			    <fieldset>
			        <legend>Find a country</legend>

			        <label for="query">What are you looking for?</label>
			        <input id="query" type="search" placeholder="Try Norway" autofocus="autofocus">

					<div class="pure-menu pure-menu-open">
					    <a class="pure-menu-heading">Suggestions</a>

					    <ul>
					        <li><a href="#">Flickr</a></li>
					    </ul>
					</div>

			        <button type="submit" class="pure-button pure-button-primary">Don't push me!</button>
			    </fieldset>
			</form>
	    </div>

	    <div class="pure-u-1-3">
	        <!-- Padding -->
	    </div>
	</div>
</body>
</html>
